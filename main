--// SERVICES
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

--// CONFIG
local ESP_ENABLED = true
local TEAM_CHECK =  false


--// ESP SYSTEM
local Highlights = {}

local function ApplyESP(player)
	if player == LocalPlayer then return end

	local function onCharacter(char)
		if Highlights[player] then
			Highlights[player]:Destroy()
		end

		local hl = Instance.new("Highlight")
		hl.FillTransparency = 0.5
		hl.OutlineTransparency = 0
		hl.Parent = char

		Highlights[player] = hl
	end

	if player.Character then
		onCharacter(player.Character)
	end

	player.CharacterAdded:Connect(onCharacter)
end

local function RemoveESP(player)
	if Highlights[player] then
		Highlights[player]:Destroy()
		Highlights[player] = nil
	end
end

--// UPDATE LOOP
task.spawn(function()
	while task.wait(0.5) do
		for _, player in inpairs(Players:GetPlayers()) do
			if player ~= LocalPlayer and player.Character then

				if TEAM_CHECK
					and player.Team ~= nil
					and LocalPlayer.Team ~= nil
					and player.Team == LocalPlayer.Team then

					RemoveESP(player)
					continue
				end

				if ESP_ENABLED then
					if not Highlights[player] then
						ApplyESP(player)
					end
				else
					RemoveESP(player)
				end
			end
		end
	end
end)

Players.PlayerRemoving:Connect(RemoveESP)
